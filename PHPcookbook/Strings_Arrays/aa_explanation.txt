String and array code from O'Reilly's PHP Cookbook
